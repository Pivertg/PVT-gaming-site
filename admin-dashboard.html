<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<script>
    // V√©rifie si l'utilisateur est bien un admin
    if (localStorage.getItem("adminToken") !== "adminLoggedIn") {
        alert("‚ùå Acc√®s refus√© ! Veuillez vous connecter.");
        window.location.href = "admin.html"; // Redirige vers la connexion
    }
</script>
<button onclick="logout()">üö™ Se d√©connecter</button>
<script>
    function logout() {
        localStorage.removeItem("adminToken"); // Supprime l'authentification
        alert("üëã D√©connexion r√©ussie !");
        window.location.href = "admin.html"; // Redirige vers la connexion
    }
</script>
<body>
    <h1>Gestion des Rosters</h1>

    <!-- Ajouter un roster -->
    <input type="text" id="rosterName" placeholder="Nom du roster">
    <button onclick="ajouterRoster()">Ajouter Roster</button>

    <!-- Liste des rosters -->
    <ul id="rosterList"></ul>

    <script>
        const API_URL = "http://localhost:3000/api";

        async function chargerRosters() {
            const response = await fetch(`${API_URL}/rosters`);
            const rosters = await response.json();
            const rosterList = document.getElementById("rosterList");
            rosterList.innerHTML = "";

            rosters.forEach(roster => {
                const li = document.createElement("li");
                li.innerHTML = `
                    ${roster.nom} 
                    <button onclick="supprimerRoster(${roster.id})">‚ùå</button>
                    <button onclick="afficherJoueurs(${roster.id})">Voir joueurs</button>
                    <ul id="joueurs-${roster.id}"></ul>
                    <input type="text" id="joueurPseudo-${roster.id}" placeholder="Pseudo">
                    <input type="text" id="joueurIdBrawl-${roster.id}" placeholder="ID Brawl Stars">
                    <input type="number" id="joueurTrophies-${roster.id}" placeholder="Troph√©es">
                    <button onclick="ajouterJoueur(${roster.id})">Ajouter Joueur</button>
                `;
                rosterList.appendChild(li);
            });
        }

        async function ajouterRoster() {
            const nom = document.getElementById("rosterName").value;
            await fetch(`${API_URL}/rosters`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nom })
            });
            chargerRosters();
        }

        async function supprimerRoster(id) {
            await fetch(`${API_URL}/rosters/${id}`, { method: "DELETE" });
            chargerRosters();
        }

        async function afficherJoueurs(rosterId) {
            const response = await fetch(`${API_URL}/rosters/${rosterId}`);
            const joueurs = await response.json();
            const joueursList = document.getElementById(`joueurs-${rosterId}`);
            joueursList.innerHTML = "";

            joueurs.forEach(joueur => {
                const li = document.createElement("li");
                li.innerHTML = `${joueur.pseudo} - ${joueur.trophies} üèÜ
                    <button onclick="supprimerJoueur(${rosterId}, ${joueur.id})">‚ùå</button>`;
                joueursList.appendChild(li);
            });
        }

        async function ajouterJoueur(rosterId) {
            const pseudo = document.getElementById(`joueurPseudo-${rosterId}`).value;
            const idBrawlStars = document.getElementById(`joueurIdBrawl-${rosterId}`).value;
            const trophies = document.getElementById(`joueurTrophies-${rosterId}`).value;

            await fetch(`${API_URL}/rosters/${rosterId}/joueurs`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ pseudo, idBrawlStars, trophies })
            });
            afficherJoueurs(rosterId);
        }

        async function supprimerJoueur(rosterId, joueurId) {
            await fetch(`${API_URL}/rosters/${rosterId}/joueurs/${joueurId}`, { method: "DELETE" });
            afficherJoueurs(rosterId);
        }

        chargerRosters();
    </script>
</body>
</html>
