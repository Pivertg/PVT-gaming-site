<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style-admin.css">
</head>
<script>
    if (sessionStorage.getItem("adminToken") !== "adminLoggedIn") {
        alert("‚ùå Acc√®s refus√© ! Veuillez vous connecter.");
        window.location.href = "admin.html";
    }

    function logout() {
        sessionStorage.removeItem("adminToken");
        alert("üëã D√©connexion r√©ussie !");
        window.location.href = "admin.html";
    }
</script>
<body>

    <div class="navbar">
        <h1>Dashboard</h1>
        <button onclick="logout()">üö™ Se d√©connecter</button>
    </div>

    <div class="add-player">
        <button onclick="ajouterJoueur()">‚ûï Ajouter un joueur</button>
    </div>

    <div id="joueurs-container"></div>

    <script>
        const API_URL = "https://pvt-gaming-api.gamingpivert.workers.dev/api/joueurs";

        async function chargerJoueurs() {
            const response = await fetch(API_URL);
            const joueurs = await response.json();
            const container = document.getElementById("joueurs-container");
            container.innerHTML = "";

            const groupedByRoster = {};

            joueurs.forEach(joueur => {
                const roster = joueur.roster || "Inconnu";
                if (!groupedByRoster[roster]) groupedByRoster[roster] = [];
                groupedByRoster[roster].push(joueur);
            });

            for (const roster in groupedByRoster) {
                const div = document.createElement("div");
                div.classList.add("roster-block");
                div.innerHTML = `<h2>${roster}</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Pseudo</th>
                            <th>Troph√©es</th>
                            <th>Win 3v3</th>
                            <th>Classement</th>
                            <th>Rang Max</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${groupedByRoster[roster].map(joueur => `
                            <tr>
                                <td>${joueur.pseudo}</td>
                                <td>${joueur.trophees}</td>
                                <td>${joueur.win3v3}</td>
                                <td>${joueur.classement}</td>
                                <td>${joueur.rangMax}</td>
                                <td>
                                    <button onclick="supprimerJoueur('${joueur.id}')">‚ùå</button>
                                </td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>`;
                container.appendChild(div);
            }
        }

        async function ajouterJoueur() {
            const id = prompt("ID unique du joueur (ex: uuid ou pseudo#tag)").trim();
            const pseudo = prompt("Pseudo du joueur :").trim();
            const trophees = prompt("Nombre de troph√©es :").trim();
            const win3v3 = prompt("Victoires 3v3 :").trim();
            const classement = prompt("Classement :").trim();
            const rangMax = prompt("Rang Max :").trim();
            const roster = prompt("Nom du roster (ex: roster4, roster5) :").trim();

            if (!id || !pseudo || !trophees || !win3v3 || !classement || !roster) {
                alert("Tous les champs obligatoires doivent √™tre remplis !");
                return;
            }

            const joueur = {
                id,
                pseudo,
                trophees: parseInt(trophees),
                win3v3: parseInt(win3v3),
                classement,
                rangMax,
                roster
            };

            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(joueur)
            });

            if (response.ok) {
                alert("‚úÖ Joueur ajout√© !");
                chargerJoueurs();
            } else {
                const err = await response.text();
                alert("‚ùå Erreur : " + err);
            }
        }

        async function supprimerJoueur(id) {
            if (!confirm("Supprimer ce joueur ?")) return;

            const response = await fetch(`${API_URL}/${id}`, {
                method: "DELETE"
            });

            if (response.ok) {
                alert("‚úÖ Joueur supprim√© !");
                chargerJoueurs();
            } else {
                alert("‚ùå Erreur lors de la suppression");
            }
        }

        chargerJoueurs();
    </script>

</body>
</html>
