<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="navbar">
        <h1>Dashboard</h1>
        <button onclick="logout()">üö™ Se d√©connecter</button>
    </div>

    <div class="add-roster">
        <input type="text" id="rosterName" placeholder="Nom du roster">
        <button onclick="ajouterRoster()">Ajouter Roster</button>
    </div>

    <div class="roster-container" id="rosterList"></div>

    <script>
        const API_URL = "http://localhost:3000/api";

        async function chargerRosters() {
            const response = await fetch(`${API_URL}/rosters`);
            const rosters = await response.json();
            const rosterList = document.getElementById("rosterList");
            rosterList.innerHTML = "";

            rosters.forEach(roster => {
                const div = document.createElement("div");
                div.classList.add("roster-card");
                div.innerHTML = `
                    <input type="text" class="editable" value="${roster.nom}" onblur="modifierRoster(${roster.id}, this.value)">
                    <button onclick="supprimerRoster(${roster.id})">‚ùå Supprimer</button>

                    <table>
                        <thead>
                            <tr>
                                <th>Pseudo</th>
                                <th>üèÜ Troph√©es</th>
                                <th>üèÖ Win 3V3</th>
                                <th>üìä Class√©</th>
                                <th>üîù Rang Max</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="joueurs-${roster.id}">
                        </tbody>
                    </table>

                    <div class="add-player">
                        <button onclick="ajouterJoueur(${roster.id})">+ Ajouter un joueur</button>
                    </div>
                `;

                rosterList.appendChild(div);
                afficherJoueurs(roster.id);
            });
        }

        async function modifierRoster(rosterId, nouveauNom) {
            await fetch(`${API_URL}/rosters/${rosterId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nom: nouveauNom })
            });
        }

        async function ajouterRoster() {
            const nom = document.getElementById("rosterName").value;
            await fetch(`${API_URL}/rosters`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nom })
            });
            chargerRosters();
        }

        async function supprimerRoster(id) {
            await fetch(`${API_URL}/rosters/${id}`, { method: "DELETE" });
            chargerRosters();
        }

        async function afficherJoueurs(rosterId) {
            const response = await fetch(`${API_URL}/rosters/${rosterId}`);
            const data = await response.json();
            const joueursList = document.getElementById(`joueurs-${rosterId}`);
            joueursList.innerHTML = "";

            data.joueurs.forEach(joueur => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td><input type="text" class="editable" value="${joueur.pseudo}" onblur="modifierJoueur(${rosterId}, ${joueur.id}, 'pseudo', this.value)"></td>
                    <td><input type="number" class="editable" value="${joueur.trophies}" onblur="modifierJoueur(${rosterId}, ${joueur.id}, 'trophies', this.value)"></td>
                    <td><input type="number" class="editable" value="${joueur.win3v3}" onblur="modifierJoueur(${rosterId}, ${joueur.id}, 'win3v3', this.value)"></td>
                    <td><input type="text" class="editable" value="${joueur.classement}" onblur="modifierJoueur(${rosterId}, ${joueur.id}, 'classement', this.value)"></td>
                    <td><input type="number" class="editable" value="${joueur.rangMax}" onblur="modifierJoueur(${rosterId}, ${joueur.id}, 'rangMax', this.value)"></td>
                    <td><button onclick="supprimerJoueur(${rosterId}, ${joueur.id})">‚ùå</button></td>
                `;
                joueursList.appendChild(tr);
            });
        }

        async function modifierJoueur(rosterId, joueurId, champ, valeur) {
            await fetch(`${API_URL}/rosters/${rosterId}/joueurs/${joueurId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ [champ]: valeur })
            });
        }

        async function ajouterJoueur(rosterId) {
            const pseudo = prompt("Pseudo du joueur :");
            const trophies = prompt("Nombre de troph√©es :");
            const win3v3 = prompt("Nombre de victoires en 3V3 :");
            const classement = prompt("Class√© (Bronze, Argent, Or...) :");
            const rangMax = prompt("Rang Max atteint :");

            if (pseudo && trophies && win3v3 && classement && rangMax) {
                await fetch(`${API_URL}/rosters/${rosterId}/joueurs`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ pseudo, trophies, win3v3, classement, rangMax })
                });
                afficherJoueurs(rosterId);
            }
        }

        async function supprimerJoueur(rosterId, joueurId) {
            await fetch(`${API_URL}/rosters/${rosterId}/joueurs/${joueurId}`, { method: "DELETE" });
            afficherJoueurs(rosterId);
        }

        function logout() {
            localStorage.removeItem("adminToken");
            alert("üëã D√©connexion r√©ussie !");
            window.location.href = "admin.html";
        }

        chargerRosters();
    </script>

</body>
</html>
